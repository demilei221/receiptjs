<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/javascript" src="../lib/receipt.js"></script>
<script type="text/javascript" src="../lib/receipt-printer.js"></script>
<script type="text/javascript" src="../lib/receipt-serial.js"></script>
<script type="text/javascript" src="../lib/qrcode-generator/qrcode.js"></script>
<script type="text/javascript">

const transaction = {
    datetime: new Date().toLocaleString(),
    items: [
        { name: 'Asparagus', quantity: 1, amount: 100 },
        { name: 'Broccoli', quantity: 2, amount: 200 },
        { name: 'Carrot', quantity: 3, amount: 300 },
    ],
    total: 600
};

const template = `^^^RECEIPT

${transaction.datetime}
${transaction.items.map(item => `${item.name} | ${item.quantity}| ${item.amount}`).join('\n')}
---
^TOTAL | ^${transaction.total}`;

function initialize() {
    const open = document.querySelector('#open');
    const print = document.querySelector('#print');
    const close = document.querySelector('#close');
    const hr = document.querySelector('hr');
    const log = msg => {
        const div = document.createElement('div');
        div.append(`${new Date().toISOString()} ${msg}`);
        hr.after(div);
    };
    let conn = null;
    open.onclick = async () => {
        if (!conn) {
            conn = ReceiptSerial.connect();
            conn.on('status', status => {
                log(status);
            });
            conn.on('ready', () => {
                log('ready');
            });
        }
    };
    print.onclick = async () => {
        if (conn) {
            log(await conn.print(template, '-c 42'));
        }
    };
    close.onclick = () => {
        if (conn) {
            conn.close();
            conn = null;
        }
    };
}
</script>
</head>
<body onload="initialize()">
<button id="open">Open</button>
<button id="print">Print</button>
<button id="close">Close</button>
<hr>
</body>
</html>
